/*!
 * @author Szymon Działowski
 * @ver 1.0 - 2014-09-02
 * @homepage https://github.com/stopsopa/ipromise
 * @spec http://promisesaplus.com/
 * @demo http://stopsopa.bitbucket.org/demos/ipromise/demo.html
 *
 * Copyright (c) 2014 Szymon Działowski
 * Released under the MIT license
 * http://en.wikipedia.org/wiki/MIT_License
 */
;(function(a,c,b){if(typeof global==="object"){global[a]=b}if(typeof module==="object"&&module.exports){module.exports=b}c[a]=b})("ipromise",this,(function(l,n){for(var e in l){l[l[e]]=e}function g(i){return Array.prototype.slice.call(i,0)}function f(i){return toString.call(i)=="[object Array]"}function p(i){return toString.call(i)=="[object Object]"}function b(i){return typeof i=="function"||false}var c=(function(){try{return process.nextTick}catch(i){}try{return setImmediate}catch(i){}return function(q){setTimeout(q,0)}})();function d(r,q){var t;for(var s=0;s<q.length;++s){t=q[s];if(b(t)){r.push(t)}else{if(f(t)){d(r,t)}}}return r}function k(i){return d([],g(i))}function m(q,t,s){var r=k(t);for(var u=0;u<r.length;++u){r[u].status=s;q.push(r[u])}}function j(t,i){try{if(t===i){throw new TypeError("promise and x are the same object")}if(p(i)||b(i)){var s=i.then;if(b(s)){var q=true;try{s.call(i,function(u){if(q){j(t,u);q=false}},function(u){if(q){t.reject(u);q=false}})}catch(r){q&&t.reject(r)}}else{t.resolve(i)}}else{t.resolve(i)}}catch(r){t.reject(r)}}function a(q,i){c(function(){if(q.promise){try{j(q.promise,q.apply(n,i))}catch(r){q.promise.reject(r)}return}q.apply(n,i)})}function h(q,u,r){for(var t=0;t<q.length;++t){(!u||(q[t].status&u))&&a(q[t],r)}}return function o(){if(this.constructor!=o){return new o()}var s=l.PENDING,r,q,i=[];this.then=function(v,u){var t=new o();b(v)||(v=function(){t.resolve.apply(n,arguments)});b(u)||(u=function(){t.reject.apply(n,arguments)});v.promise=u.promise=t;this.done(v).fail(u);return t};this.resolve=function(){if(s==l.PENDING){s=l.RESOLVED;r=g(arguments);h(i,l.DONE,r);delete i}return this};this.reject=function(){if(s==l.PENDING){s=l.REJECTED;r=g(arguments);h(i,l.FAIL,r);delete i}return this};this.done=function(){(s==l.PENDING)&&m(i,arguments,l.DONE);(s==l.RESOLVED)&&h(k(arguments),n,r);return this};this.fail=function(){(s==l.PENDING)&&m(i,arguments,l.FAIL);(s==l.REJECTED)&&h(k(arguments),n,r);return this};this.progress=function(){if(s==l.PENDING){m(i,arguments,l.PROGRESS)}else{h(k(arguments),n,q)}return this};this.always=function(){if(s==l.PENDING){m(i,arguments,l.DONE|l.FAIL,r)}else{h(k(arguments),n,r)}return this};this.notify=function(){q=g(arguments);(s==l.PENDING)&&h(i,l.PROGRESS,q);return this};this.state=function(){return l[s].toLowerCase()};return this}})({PENDING:1,RESOLVED:2,REJECTED:4,DONE:8,FAIL:16,PROGRESS:32}));