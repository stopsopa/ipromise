/*!
 * @author Szymon Działowski
 * @ver 1.0 - 2014-09-02
 * @homepage https://github.com/stopsopa/ipromise
 * @spec http://promisesaplus.com/
 * @demo http://stopsopa.bitbucket.org/demos/ipromise/demo.html
 *
 * Copyright (c) 2014 Szymon Działowski
 * Released under the MIT license
 * http://en.wikipedia.org/wiki/MIT_License
 */
;(function(a,c,b){if(typeof global==="object"){global[a]=b}if(typeof module==="object"&&module.exports){module.exports=b}c[a]=b})("ipromise",this,(function(j,l){for(var d in j){j[j[d]]=d}function f(i){return Array.prototype.slice.call(i,0)}function e(i){return toString.call(i)=="[object Array]"}function n(i){return toString.call(i)=="[object Object]"}function a(i){return typeof i=="function"||false}var b=(function(){try{return process.nextTick}catch(i){}try{return setImmediate}catch(i){}return function(o){setTimeout(o,0)}})();function c(p,o){var r;for(var q=0;q<o.length;++q){r=o[q];if(a(r)){p.push(r)}else{if(e(r)){c(p,r)}}}return p}function h(i){return c([],f(i))}function k(o,r,q){var p=h(r);for(var s=0;s<p.length;++s){p[s].status=q;o.push(p[s])}}function g(r,i){try{if(r===i){throw new TypeError("promise and x are the same object")}if(n(i)||a(i)){var q=i.then;if(a(q)){var o=true;try{q.call(i,function(s){if(o){g(r,s);o=false}},function(s){if(o){r.reject(s);o=false}})}catch(p){o&&r.reject(p)}}else{r.resolve(i)}}else{r.resolve(i)}}catch(p){r.reject(p)}}return function m(){if(this.constructor!=m){return new m()}var r=j.PENDING;var q,p,o=[];function i(t,u){b(function(){if(t.promise){try{g(t.promise,t.apply(l,q))}catch(v){t.promise.reject(v)}return}if(u){return t.apply(l,p)}t.apply(l,q)})}function s(t,v,w){for(var u=0;u<t.length;++u){v?((t[u].status&v)&&i(t[u],w)):i(t[u],w)}}this.then=function(v,u){var t=new m();a(v)||(v=function(){t.resolve.apply(l,arguments)});a(u)||(u=function(){t.reject.apply(l,arguments)});v.promise=u.promise=t;this.done(v).fail(u);return t};this.done=function(){(r==j.PENDING)&&k(o,arguments,j.DONE);(r==j.RESOLVED)&&s(h(arguments));return this};this.fail=function(){(r==j.PENDING)&&k(o,arguments,j.FAIL);(r==j.REJECTED)&&s(h(arguments));return this};this.progress=function(){if(r==j.PENDING){k(o,arguments,j.PROGRESS)}else{s(h(arguments),l,true)}return this};this.always=function(){if(r==j.PENDING){k(o,arguments,j.DONE|j.FAIL)}else{s(h(arguments))}return this};this.resolve=function(){if(r==j.PENDING){r=j.RESOLVED;q=f(arguments);s(o,j.DONE);delete o}return this};this.notify=function(){p=f(arguments);(r==j.PENDING)&&s(o,j.PROGRESS,true);return this};this.reject=function(){if(r==j.PENDING){r=j.REJECTED;q=f(arguments);s(o,j.FAIL);delete o}return this};this.state=function(){return j[r].toLowerCase()};return this}})({PENDING:1,RESOLVED:2,REJECTED:4,DONE:8,FAIL:16,PROGRESS:32}));
