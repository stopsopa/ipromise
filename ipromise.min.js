/*!
 * @author Szymon Działowski
 * @ver 1.0 - 2014-09-02
 * @compressed 2015-12-04 in http://refresh-sf.com/
 * @homepage https://github.com/stopsopa/ipromise
 * @spec http://promisesaplus.com/
 * @demo http://stopsopa.bitbucket.org/demos/ipromise/demo.html
 *
 * Copyright (c) 2014 Szymon Działowski
 * Released under the MIT license
 * http://en.wikipedia.org/wiki/MIT_License
 */
!function(t,e,n){"object"==typeof global&&(global[t]=n),"object"==typeof module&&module.exports&&(module.exports=n),e[t]=n}("ipromise",this,function(t,e){function n(t){return Array.prototype.slice.call(t,0)}function r(t){return"[object Array]"==toString.call(t)}function o(t){return"[object Object]"==toString.call(t)}function i(t){return"function"==typeof t||!1}function u(t,e){for(var n,o=0;o<e.length;++o)n=e[o],i(n)?t.push(n):r(n)&&u(t,n);return t}function s(t){return u([],n(t))}function c(t,e,n){for(var r=s(e),o=0;o<r.length;++o)r[o].status=n,t.push(r[o])}function a(t,e){try{if(t===e)throw new TypeError("promise and x are the same object");if(o(e)||i(e)){var n=e.then;if(i(n)){var r=!0;try{n.call(e,function(e){r&&(r=!1,a(t,e))},function(e){r&&(r=!1,t.reject(e))})}catch(u){r&&t.reject(u)}}else t.resolve(e)}else t.resolve(e)}catch(u){t.reject(u)}}function f(t,n){E(function(){if(t.promise)try{a(t.promise,t.apply(e,n))}catch(r){t.promise.reject(r)}else t.apply(e,n)})}function l(t,e,n){for(var r=0;r<t.length;++r)(!e||t[r].status&e)&&f(t[r],n)}for(var h in t)t[t[h]]=h;var E=function(t){try{return process.nextTick(t),process.nextTick}catch(e){}try{return setImmediate(t),setImmediate}catch(e){}return function(t){setTimeout(t,0)}}(function(){});return function m(){if(this.constructor!=m)return new m;var r,o,u=t.PENDING,a=[];return this.then=function(t,n){var r=new m;return i(t)||(t=function(){r.resolve.apply(e,arguments)}),i(n)||(n=function(){r.reject.apply(e,arguments)}),t.promise=n.promise=r,this.done(t).fail(n),r},this.resolve=function(){return u==t.PENDING&&(u=t.RESOLVED,r=n(arguments),l(a,t.DONE,r),delete a),this},this.reject=function(){return u==t.PENDING&&(u=t.REJECTED,r=n(arguments),l(a,t.FAIL,r),delete a),this},this.done=function(){return u==t.PENDING&&c(a,arguments,t.DONE),u==t.RESOLVED&&l(s(arguments),e,r),this},this.fail=function(){return u==t.PENDING&&c(a,arguments,t.FAIL),u==t.REJECTED&&l(s(arguments),e,r),this},this.progress=function(){return u==t.PENDING?c(a,arguments,t.PROGRESS):l(s(arguments),e,o),this},this.always=function(){return u==t.PENDING?c(a,arguments,t.DONE|t.FAIL,r):l(s(arguments),e,r),this},this.notify=function(){return o=n(arguments),u==t.PENDING&&l(a,t.PROGRESS,o),this},this.state=function(){return t[u].toLowerCase()},this}}({PENDING:1,RESOLVED:2,REJECTED:4,DONE:8,FAIL:16,PROGRESS:32}));
